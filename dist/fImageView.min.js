var Fei=window.Fei={version:"1.0.0"};!function(){var t,e,i,n,a={tabindex:"tabIndex",readonly:"readOnly",for:"htmlFor",class:"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",usemap:"useMap",frameborder:"frameBorder",contenteditable:"contentEditable"},r=(div=document.createElement("div"),div.setAttribute("class","t"),"t"===div.className),s=Object.prototype.toString,h=["valueOf","toLocaleString","toString","constructor"],l=Fei.utils={getScrollTop:function(t){return t=t||document,Math.max(t.documentElement.scrollTop,t.body.scrollTop)},getScrollLeft:function(t){return t=t||document,Math.max(t.documentElement.scrollLeft,t.body.scrollLeft)},getCoord:function(t){var e=0,i=0;if(document.documentElement.getBoundingClientRect){var n=t.getBoundingClientRect(),a=t.ownerDocument;i=0<=navigator.userAgent.indexOf("MSIE 6.0")?(e=n.top-2+l.getScrollTop(a),n.left-2+l.getScrollLeft(a)):(e=n.top+l.getScrollTop(a),n.left+l.getScrollLeft(a))}else for(;t.offsetParent;)e+=t.offsetTop,i+=t.offsetLeft,t=t.offsetParent;return{top:e,left:i}},setAttr:function(t,e,i){return t&&(t.setAttribute(r?e:a[e]||e,i),"style"===e&&(t.style.cssText=i)),t},getAttr:function(t,e){return t.getAttribute(r?e:a[e]||e)},createElement:function(t,e){var i=document.createElementNS?document.createElementNS("http://www.w3.org/1999/xhtml",t):document.createElement(t);if(e)for(var n in e)l.setAttr(i,n,e[n]);return i},removeChildren:function(t){for(var e=t.childNodes,i=e.length-1;0<=i;i--)t.removeChild(e.item(i))},getBrowserStyle:function(t,e){for(var i=["","-o-","-ms-","-moz-","-webkit-"],n="",a=0;a<i.length;a++)n+=i[a]+t+":"+e+";";return n},addEvent:function(t,e,i,n){if(!t)return t;function a(){i.apply(n||this,arguments)}t.addEventListener?t.addEventListener(e,a,!1):t.attachEvent?t.attachEvent("on"+e,a):t["on"+e]=a},getGuid:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=16*Math.random()|0;return("x"===t?e:3&e|8).toString(16)})},clone:function(t){if(null==t)return t;if(t.nodeType&&t.cloneNode)return t.cloneNode(!0);var e,i,n,a,r,o=s.call(t);if("[object Date]"===o)return new Date(t.getTime());if("[object Array]"===o)for(e=t.length,a=[];e--;)a[e]=l.clone(t[e]);else if("[object Object]"===o&&t.constructor===Object){for(r in a={},t)a[r]=l.clone(t[r]);for(i=h.length;i--;)n=h[i],t.hasOwnProperty(n)&&(a[n]=t[n])}return a||t},isUseVml:(t=navigator.userAgent.toLowerCase(),e=!!window.ActiveXObject||"ActiveXObject"in window,i=e&&-1<t.indexOf("msie")&&8===parseInt(t.match(/msie ([\d.]+)/)[1]),n=e&&-1<t.indexOf("msie")&&parseInt(t.match(/msie ([\d.]+)/)[1])<8,function(t){return i||n})}}(),function(){var a=Fei.utils;if(a.isUseVml()){Fei.ieRotate={rotate:function(t,e){if(!t)return t;if(0!==this.length&&void 0!==e){var i;if("number"==typeof e&&(e={angle:e}),t.Fei&&t.Fei.PhotoEffect)t.Fei.PhotoEffect._handleRotation(e),i=t.Fei.PhotoEffect._rootObj;else{var n=a.clone(e);i=new Fei.PhotoEffect(t,n)._rootObj}return i}}};Fei.PhotoEffect=function(t,e){if(this._img=t,this._onLoadDelegate=[e],this._rootObj=document.createElement("span"),this._rootObj.style.display="inline-block",this._rootObj.Fei={PhotoEffect:this},t.parentNode.insertBefore(this._rootObj,t),t.complete)this._Loader();else{var i=this;t.onload=function(){i._Loader.call(i)},t.onreadystatechange=function(){"complete"==this.readyState&&i._Loader.call(i)}}},Fei.PhotoEffect.prototype={_setupParameters:function(t){this._parameters=this._parameters||{},"number"!=typeof this._angle&&(this._angle=0),"number"==typeof t.angle&&(this._angle=t.angle),this._parameters.animateTo="number"==typeof t.animateTo?t.animateTo:this._angle,this._parameters.step=t.step||this._parameters.step||null,this._parameters.easing=t.easing||this._parameters.easing||this._defaultEasing,this._parameters.duration=t.duration||this._parameters.duration||1e3,this._parameters.callback=t.callback||this._parameters.callback||this._emptyFunction,this._parameters.center=t.center||this._parameters.center||["50%","50%"],"string"==typeof this._parameters.center[0]?this._rotationCenterX=parseInt(this._parameters.center[0],10)/100*this._imgWidth*this._aspectW:this._rotationCenterX=this._parameters.center[0],"string"==typeof this._parameters.center[1]?this._rotationCenterY=parseInt(this._parameters.center[1],10)/100*this._imgHeight*this._aspectH:this._rotationCenterY=this._parameters.center[1],t.bind&&t.bind!=this._parameters.bind&&this._BindEvents(t.bind)},_emptyFunction:function(){},_defaultEasing:function(t,e,i,n,a){return-n*((e=e/a-1)*e*e*e-1)+i},_handleRotation:function(t,e){this._setupParameters(t),this._angle==this._parameters.animateTo?this._rotate(this._angle):this._animateStart()},_BindEvents:function(t){if(t&&this._eventObj){if(this._parameters.bind)this._parameters.bind;this._parameters.bind=t}},_Loader:function(){var t,e=this._img.width,i=this._img.height,n=this._img.style.top,a=this._img.style.left,r=this._img.style.cursor;for(this._imgWidth=e,this._imgHeight=i,this._img.parentNode.removeChild(this._img),this._vimage=this.createVMLNode("image"),this._vimage.src=this._img.src,this._vimage.style.height="100%",this._vimage.style.width="100%",this._vimage.style.position="absolute",this._vimage.style.top="0px",this._vimage.style.left="0px",this._vimage.setAttribute("id",this._img.getAttribute("id")+"_img"),this._aspectW=this._aspectH=1,this._container=this.createVMLNode("group"),this._container.style.width=e,this._container.style.height=i,this._container.style.position="absolute",this._container.style.top="0px",this._container.style.left="0px",this._container.setAttribute("coordsize",e-1+","+(i-1)),this._container.appendChild(this._vimage),this._rootObj.appendChild(this._container),this._rootObj.style.position="relative",this._rootObj.style.width=e+"px",this._rootObj.style.height=i+"px",this._rootObj.style.top=n,this._rootObj.style.left=a,this._rootObj.style.cursor=r,this._rootObj.setAttribute("id",this._img.getAttribute("id")),this._rootObj.className=this._img.className,this._eventObj=this._rootObj;t=this._onLoadDelegate.shift();)this._handleRotation(t,!0)},_animateStart:function(){this._timer&&clearTimeout(this._timer),this._animateStartTime=+new Date,this._animateStartAngle=this._angle,this._animate()},_animate:function(){var t=+new Date,e=t-this._animateStartTime>this._parameters.duration;if(e&&!this._parameters.animatedGif)clearTimeout(this._timer);else{if(this._canvas||this._vimage||this._img){var i=this._parameters.easing(0,t-this._animateStartTime,this._animateStartAngle,this._parameters.animateTo-this._animateStartAngle,this._parameters.duration);this._rotate(~~(10*i)/10)}this._parameters.step&&this._parameters.step(this._angle);var n=this;this._timer=setTimeout(function(){n._animate.call(n)},10)}this._parameters.callback&&e&&(this._angle=this._parameters.animateTo,this._rotate(this._angle),this._parameters.callback.call(this._rootObj))},_rotate:function(){Math.PI;return function(t){this._angle=t,this._container.style.rotation=t%360+"deg",this._vimage.style.top=-(this._rotationCenterY-this._imgHeight/2)+"px",this._vimage.style.left=-(this._rotationCenterX-this._imgWidth/2)+"px",this._container.style.top=this._rotationCenterY-this._imgHeight/2+"px",this._container.style.left=this._rotationCenterX-this._imgWidth/2+"px"}}(),createVMLNode:function(){document.createStyleSheet().addRule(".rvml","behavior:url(#default#VML)");try{return document.namespaces.rvml||document.namespaces.add("rvml","urn:schemas-microsoft-com:vml"),function(t){return document.createElement("<rvml:"+t+' class="rvml">')}}catch(t){return function(t){var e=document.createElement(t);return e.setAttribute("class","rvml"),e.setAttribute("className","rvml"),e.setAttribute("xmlns","urn:schemas-microsoft.com:vml"),e}}}()}}}(),function(){var r=Fei.utils;(Fei.fImage=function(t){var e=this;if(e.isLoaded=!1,e.src="",e.orgWidth=0,e.orgHeight=0,e.width=0,e.height=0,e.rotation=0,e.translateSpeed=300,e.translates={y:0,x:0},e.domId="fei_imgview_"+r.getGuid(),e.dom=r.createElement("img",{id:e.domId}),e.onload=function(){},t)for(var i in t)e[i]=t[i];e.orgTranslateSpeed=e.translateSpeed}).prototype={init:function(){var t=this;return t.src&&t.setSrc(t.src),t.dom.complete?t.imgLoad.call(t):(t.dom.onload=function(){t.imgLoad.call(t)},t.dom.onreadystatechange=function(){"complete"==this.readyState&&t.imgLoad.call(t)}),t},imgLoad:function(){var t=this;if(!t.isLoaded){t.isLoaded=!0;try{var e=new Image;e.src=t.src;function i(){t.width=e.width,t.height=e.height,t.orgWidth=e.width,t.orgHeight=e.height,t.rotation=0,t.onload&&t.onload.call(window,t)}e.complete?i():(e.onload=function(){i()},t.dom.onreadystatechange=function(){"complete"==this.readyState&&i()}),delete e}catch(t){}}},setSrc:function(t){var e=this;return e.isLoaded=!1,e.src=t||e.src,e.dom.src=e.src,e.dom.complete&&e.imgLoad.call(e),e},doChange:function(){var t=this,e=document.getElementById(t.domId);if(e){if(r.isUseVml()){if(e.style.left=t.translates.x+"px",e.style.top=t.translates.y+"px",!t.isMoveing){e.style.cursor="move",e.style.width=t.width+"px",e.style.height=t.height+"px";var i=e.children||e.childNodes;if(0<i.length){var n=i[0];n.style.width=t.width+"px",n.style.height=t.height+"px"}Fei.ieRotate.rotate(document.getElementById(t.domId),{animateTo:t.rotation,duration:t.translateSpeed})}}else{var a="cursor:move;width:"+t.width+"px;height:"+t.height+"px;";a+=r.getBrowserStyle("transform","translate("+t.translates.x+"px,"+t.translates.y+"px) rotate("+t.rotation+"deg)"),0<t.translateSpeed&&(a+=r.getBrowserStyle("transition","all "+t.translateSpeed/1e3+"s ease")),r.setAttr(e,"style",a)}return t}},scale:function(t,e,i){var n=this,a=n.rotation%360,r=n.getAdSize(),o=0;e=e||.5,i=i||.5;90!=a&&270!=a&&-90!=a&&-270!=a||(o=(r.h-r.w)/2);var s=n.translates.x-(n.width-r.w)/2+o-(n.width*t-n.width)*e,h=n.translates.y-(n.height-r.h)/2-o-(n.height*t-n.height)*i;return n.width=n.width*t,n.height=n.height*t,n.transition(s,h),n},transition:function(t,e){return this.translates.y=e,this.translates.x=t,this},rotate:function(t){return this.rotation=this.rotation+t,this},getAdSize:function(){var t=this,e=t.rotation%360,i=t.width,n=t.height;return 90!=e&&270!=e&&-90!=e&&-270!=e||(i=t.height,n=t.width),{w:i,h:n}},setAdSize:function(t,e){var i=this,n=i.rotation%360;return 90==n||270==n||-90==n||-270==n?(i.height=t,i.width=e):(i.height=e,i.width=t),i},getOrgSize:function(){var t=this,e=t.rotation%360,i=t.orgWidth,n=t.orgHeight;return 90!=e&&270!=e&&-90!=e&&-270!=e||(i=t.orgHeight,n=t.orgWidth),{w:i,h:n}}}}(),function(){var n=Fei.utils;(Fei.fImagePanel=function(t){var e=this;if(e.width=0,e.height=0,e.images=[],e.currentIndex=0,e.dom=n.createElement("div",{style:"position:relative;text-align:left;width:100%;height:100%;display:block;overflow:hidden;"}),t)for(var i in t)e[i]=t[i]}).prototype={initImage:function(t){var e=this;return e.image=new Fei.fImage({src:t||"",container:e,onload:function(){e.stretchOptimally().centerImage().doChange()}}),t||e.image.setSrc(e.images[e.currentIndex]),n.removeChildren(e.dom),e.dom.appendChild(e.image.dom),e.image.init(),e.initEvents(),e},render:function(t){var e=this;return(t||document.body).appendChild(e.dom),e.width=e.dom.offsetWidth,e.height=e.dom.offsetHeight,e.coord=n.getCoord(e.dom),e.initImage(),e},setImages:function(t){var e=this;return e.images=t,e.currentIndex=0,e.image.setSrc(e.images[e.currentIndex]),e},initEvents:function(){var t=this,e=document.getElementById(t.image.domId);return n.addEvent(e,"mousedown",t.mousedown,t),n.addEvent(e,"mousemove",t.mousemove,t),n.addEvent(e,"mouseup",t.mouseup,t),n.addEvent(e,"mouseout",t.mouseup,t),"onmousewheel"in document.documentElement?n.addEvent(e,"mousewheel",t.mousewheel,t):n.addEvent(e,"DOMMouseScroll",t.mousewheel,t),t},mousewheel:function(t){var e=(t=t||window.event).wheelDelta,i=1,n=this.coord,a=t.clientX,r=t.clientY,o=this.image;void 0===e&&(e=0-(t.detail||0)),i=0<e?1.1:.9;var s=r-n.top-o.translates.y,h=a-n.left-o.translates.x;o.scale(i,h/o.width,s/o.height).doChange(),t.stopPropagation&&t.stopPropagation(),t.preventDefault&&t.preventDefault(),window.event?window.event.returnValue=!1:t.preventDefault()},mousedown:function(t){var e=this,i=(t=t||window.event,e.image);e.lastTranslateX=i.translates.x,e.lastTranslateY=i.translates.y,e.moveStartX=t.x||t.clientX,e.moveStartY=t.y||t.clientY,e.isMoveing=!0,i.isMoveing=!0,i.translateSpeed=0,t.stopPropagation&&t.stopPropagation(),t.preventDefault&&t.preventDefault(),window.event?window.event.returnValue=!1:t.preventDefault()},mousemove:function(t){var e=this;t=t||window.event;if(e.isMoveing){e.image;var i=(t.x||t.clientX)-e.moveStartX+e.lastTranslateX,n=(t.y||t.clientY)-e.moveStartY+e.lastTranslateY;e.image.transition(i,n).doChange()}t.stopPropagation&&t.stopPropagation(),t.preventDefault&&t.preventDefault(),window.event?window.event.returnValue=!1:t.preventDefault()},mouseup:function(t){this.isMoveing=!1,this.image.isMoveing=!1,this.image.translateSpeed=this.image.orgTranslateSpeed},doChange:function(){return this.image.doChange(),this},stretchH:function(){var t=this.image,e=t.getOrgSize();return t.setAdSize(this.width,e.h*this.width/e.w),this},stretchV:function(){var t=this.image,e=t.getOrgSize();return t.setAdSize(e.w*this.height/e.h,this.height),this},originalOptimally:function(){var t=this.image;return t.width=t.orgWidth,t.height=t.orgHeight,this},stretchOptimally:function(){var t=this,e=t.image,i=e.getOrgSize(),n=e.getAdSize();return i.h<=t.height&&i.w<=t.width?t.originalOptimally():n.w*t.height/n.h>t.width?t.stretchH():t.stretchV(),t},centerImage:function(){var t=this.image,e=t.rotation%360,i=t.getAdSize(),n=0;90!=e&&270!=e&&-90!=e&&-270!=e||(n=(i.h-i.w)/2);var a=(this.width-i.w)/2-n,r=(this.height-i.h)/2+n;return t.transition(a,r),this},rotate:function(t){return this.image.rotate(t),this},scale:function(t){return this.image.scale(t),this},switchTo:function(t){var e=this,i=e.image;return n.isUseVml()?e.initImage(e.images[t]):i.setSrc(e.images[t]),e},nextImage:function(){var t=this;navigator.userAgent.toLowerCase(),t.image;return t.currentIndex++,t.currentIndex>t.images.length-1&&(t.currentIndex=0),t.switchTo(t.currentIndex),t},upImage:function(){var t=this;t.image;t.currentIndex--,t.currentIndex<0&&(t.currentIndex=t.images.length-1),t.switchTo(t.currentIndex)},getImage:function(){this.image;return this.image}}}();
